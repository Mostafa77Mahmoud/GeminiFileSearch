
127.0.0.1 - - [24/Nov/2025 13:02:47] "GET /health HTTP/1.1" 200 -
127.0.0.1 - - [24/Nov/2025 13:02:47] "GET /store-info HTTP/1.1" 200 -
127.0.0.1 - - [24/Nov/2025 13:03:06] "GET /health HTTP/1.1" 200 -
127.0.0.1 - - [24/Nov/2025 13:03:06] "GET /store-info HTTP/1.1" 200 -
127.0.0.1 - - [24/Nov/2025 13:03:06] "GET /health HTTP/1.1" 200 -
127.0.0.1 - - [24/Nov/2025 13:03:06] "GET /store-info HTTP/1.1" 200 -
[INFO] Processing two-step file search request with top_k=10

============================================================
HYBRID FILE SEARCH PROCESS (Two-Step + Sensitive Clauses)
============================================================

[STEP 1/2] Extracting key terms from contract...
[INFO] Contract length: 6376 characters
[ERROR] Term extraction failed: '\n            "term_id"'
Traceback (most recent call last):
  File "/home/runner/workspace/services/file_search.py", line 160, in extract_key_terms
    extraction_prompt = self.extract_prompt_template.format(contract_text=contract_text)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyError: '\n            "term_id"'
[WARNING] No terms extracted, falling back to full contract search

[PHASE 1/2] General Search for all extracted clauses...
[INFO] Using top_k=10 for comprehensive coverage
[SEARCH] Querying Gemini File Search (Phase 1)...
[ERROR] Search failed: 503 UNAVAILABLE. {'error': {'code': 503, 'message': 'Failed to embed content.', 'status': 'UNAVAILABLE'}}
Traceback (most recent call last):
  File "/home/runner/workspace/services/file_search.py", line 299, in search_chunks
    response = self.client.models.generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/models.py", line 5218, in generate_content
    response = self._generate_content(
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/models.py", line 4000, in _generate_content
    response = self._api_client.request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/_api_client.py", line 1330, in request
    response = self._request(http_request, http_options, stream=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/_api_client.py", line 1166, in _request
    return self._retry(self._request_once, http_request, stream)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/tenacity/__init__.py", line 475, in __call__
    do = self.iter(retry_state=retry_state)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/tenacity/__init__.py", line 376, in iter
    result = action(retry_state)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/tenacity/__init__.py", line 418, in exc_check
    raise retry_exc.reraise()
          ^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/tenacity/__init__.py", line 185, in reraise
    raise self.last_attempt.result()
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/concurrent/futures/_base.py", line 449, in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
  File "/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/concurrent/futures/_base.py", line 401, in __get_result
    raise self._exception
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/tenacity/__init__.py", line 478, in __call__
    result = fn(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/_api_client.py", line 1143, in _request_once
    errors.APIError.raise_for_response(response)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/errors.py", line 106, in raise_for_response
    cls.raise_error(response.status_code, response_json, response)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/google/genai/errors.py", line 133, in raise_error
    raise ServerError(status_code, response_json, response)
google.genai.errors.ServerError: 503 UNAVAILABLE. {'error': {'code': 503, 'message': 'Failed to embed content.', 'status': 'UNAVAILABLE'}}
[ERROR] File search failed: 503 UNAVAILABLE. {'error': {'code': 503, 'message': 'Failed to embed content.', 'status': 'UNAVAILABLE'}}
127.0.0.1 - - [24/Nov/2025 13:04:06] "POST /file_search HTTP/1.1" 500 -
