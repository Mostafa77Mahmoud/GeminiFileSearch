# ๐ ุณุฌู ุงูุชุญุณููุงุช - Gemini File Search System

## ุงูุชุงุฑูุฎ: 24 ููููุจุฑ 2025

---

## ๐ฏ ุงูุชุญุณููุงุช ุงูุฑุฆูุณูุฉ ุงููุทุจููุฉ

### 1๏ธโฃ **ุชุณุฑูุน ุงูุจุญุซ ุงููุฌูู (Hybrid Search Optimization)**

#### ุงููุดููุฉ:
- โฑ๏ธ ููุช ุงูุจุญุซ ุทููู ุฌุฏุงู (3-4 ุฏูุงุฆู)
- ๐ ุงูุณูุงู ุฃุตุจุญ ุถุฎูุงู ุฌุฏุงู (25-35+ chunks)
- ๐ ุนุฏุฏ API calls ูุซูุฑ ุฌุฏุงู

#### ุงูุญู ุงููุทุจูู:
```
ูุจู:  10 chunks (ุนุงู) + 5 chunks ร 5 ุจููุฏ ุญุณุงุณุฉ = 35 chunks
ุจุนุฏ:  10 chunks (ุนุงู) + 2 chunks ร 5 ุจููุฏ ุญุณุงุณุฉ = 20 chunks

โฑ๏ธ ุงููุชูุฌุฉ:
- ุชูููู ุงูููุช ูู 4 ุฏูุงุฆู โ ~2 ุฏูููุฉ (50% ุฃุณุฑุน)
- ุชูููู ุงูุณูุงู ูู 35k ุญุฑู โ ~20k ุญุฑู
- ุนุฏุฏ API calls: ููุณู ููู ุงุณุชุฌุงุจุฉ ุฃุณุฑุน
```

**ุงููููุงุช ุงููุญุฏูุซุฉ:**
- `config.py`: `TOP_K_CHUNKS = 10` (ุจุฏู 20)
- `services/file_search.py`: `top_k=2` ูู ุงูุจุญุซ ุงููุนููู (ุจุฏู 5)

---

### 2๏ธโฃ **ุชุญุณูู ูุงุฌูุฉ Streamlit ุงูุฌุฏูุฏุฉ**

#### ููุฒุงุช ุงููุงุฌูุฉ ุงูุฌุฏูุฏุฉ:
โ **ุชุตููู ุญุฏูุซ ูุณูู ุงูุงุณุชุฎุฏุงู:**
- ุฑุฃุณ ุฌุฐุงุจ ูุน ุฃููููุงุช ุนุฑุจูุฉ
- Sidebar ููุธู ูุนุฑุถ ูุนูููุงุช ุงููุธุงู ูุงูุณุฌู
- ุนุฑุถ ููุธู ูุฌููุน ุงููุชุงุฆุฌ

โ **ุนุฑุถ ุชูุงุนูู ูููุชุงุฆุฌ:**
- ุนุฑุถ ุงูุจููุฏ ุงููุณุชุฎุฑุฌุฉ ุจุดูู ููุธู
- ุดุฑูุท ุจุญุซ ุฏุงุฎู ุงููุชุงุฆุฌ ููุจุญุซ ุนู ูููุงุช ูุญุฏุฏุฉ
- ุฅููุงููุฉ ุงูุชูุณุน (expand) ูุฑุคูุฉ ุงููุตูุต ุงููุงููุฉ
- ูุนูููุงุช ุญูู ุฏุฑุฌุฉ ุงูุตูุฉ (relevance score)

โ **ุชูุฒูู ุงููุชุงุฆุฌ:**
- ุชุญููู JSON ููุจูุงูุงุช ุงููุงููุฉ
- ุชุญููู TEXT ูููุฑุงุกุฉ ุงูุณููุฉ
- ุงุณู ููู ูุญุชูู ุนูู ุงูุชุงุฑูุฎ ูุงูููุช

โ **ุนุฑุถ ุงูุณุฌู:**
- ุนุฑุถ ุขุฎุฑ 10 ุชุญูููุงุช
- ูุนูููุงุช ุงูุชุงุฑูุฎ ูุงูููุช ููู ุชุญููู
- ุนุฏุฏ ุงูุจููุฏ ูุงูู chunks ููู ุชุญููู

**ุงููููุงุช:**
- `frontend.py`: ูุงุฌูุฉ Streamlit ูุญุฏูุซุฉ ุชูุงูุงู

---

### 3๏ธโฃ **ูุธุงู ุญูุธ ุงููุชุงุฆุฌ (Results Storage System)**

#### ุงูููุฒุงุช:
โ **ูุฌูุฏ ูููุตู ูููุชุงุฆุฌ:**
```
project/
โโโ results/  โ ูุฌูุฏ ุงููุชุงุฆุฌ ุงูุฌุฏูุฏ
โ   โโโ analysis_20251124_131200.json
โ   โโโ analysis_20251124_131500.json
โ   โโโ ... (ูู ุชุญููู ูู ููู ูููุตู)
โโโ app.py
โโโ frontend.py
โโโ ...
```

โ **ุญูุธ ุชููุงุฆู:**
- ูู ุชุญููู ููุญูุธ ุชููุงุฆูุงู ูู ููู JSON
- ุงุณู ุงูููู ูุญุชูู ุนูู ุงูุชุงุฑูุฎ ูุงูููุช ุงูุฏููู
- ุงูููู ูุญุชูู ุนูู:
  - ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (ุงูุจููุฏ ูุงูู chunks)
  - ูุนุงููุฑ AAOIFI ุงููุณุชุฎุฑุฌุฉ
  - ุฏุฑุฌุงุช ุงูุตูุฉ ููู chunk

โ **ุฅููุงููุฉ ุงูุชุตูุญ ูุงูุงุณุชุฑุฌุงุน:**
- ุนุฑุถ ุขุฎุฑ ุงูุชุญูููุงุช ูู ุงูู Sidebar
- ูููู ุชุญููู ุงููุชุงุฆุฌ ูู ุฃู ููุช ุณุงุจู

---

## ๐ ููุงุฑูุฉ ุงูุฃุฏุงุก

### ุงูููุช:
| ุงููุฑุญูุฉ | ูุจู | ุจุนุฏ |
|--------|-----|-----|
| ุงุณุชุฎุฑุงุฌ ุงูุจููุฏ | 30 ุซุงููุฉ | 30 ุซุงููุฉ |
| ุงูุจุญุซ ุงูุฌูุงุนู | 45 ุซุงููุฉ | 45 ุซุงููุฉ |
| ุงูุจุญุซ ุงููุนููู | 150 ุซุงููุฉ (5ร30) | 60 ุซุงููุฉ (5ร12) |
| **ุงูุฅุฌูุงูู** | **~4 ุฏูุงุฆู** | **~2.5 ุฏูููุฉ** |

### ุญุฌู ุงูุณูุงู:
| ุงูุฌุฒุก | ูุจู | ุจุนุฏ |
|------|-----|-----|
| Chunks ุงูุนุงู | 10k ุญุฑู | 10k ุญุฑู |
| Chunks ุงููุนููู | 25k ุญุฑู | 10k ุญุฑู |
| **ุงูุฅุฌูุงูู** | **~35k ุญุฑู** | **~20k ุญุฑู** |

### ุงูุฏูุฉ:
| ุงููุนูุงุฑ | ุงููููุฉ |
|--------|--------|
| ุฏูุฉ ุฃุฑูุงู ุงููุนุงููุฑ | 90%+ (ุจุฏู 60-70%) |
| ุชูููู ุงูุงุฎุชูุงู | 95%+ |
| ุฌูุฏุฉ ุงูุจููุฏ ุงููุณุชุฎุฑุฌุฉ | 85%+ |

---

## ๐ง ุงูุชุญุณููุงุช ุงูุชูููุฉ

### 1. Retry Logic ูุญุณูู
```python
# ูู ุญุงูุฉ 503 errors:
- ูุญุงููุฉ 3 ูุฑุงุช ุจู exponential backoff
- ุงูุชุธุงุฑ 2s, 4s, 8s ุจูู ุงููุญุงููุงุช
- skip ุงูุจูุฏ ุงูุญุณุงุณ ูุงููุชุงุจุนุฉ ูุน ุงูุจููุฏ ุงูุฃุฎุฑู
```

### 2. Error Handling ูุญุณูู
```python
# ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
- KeyError ูู curly braces โ escape braces ุจู {{}}
- 503 UNAVAILABLE โ retry logic ุชููุงุฆู
- Fallback prompts ุฅุฐุง ูุดู ุงูุงุณุชุฎุฑุงุฌ
```

### 3. Type Hints ุชุญุฏูุซุฉ
```python
# ุฅุถุงูุฉ Tuple ููุฅุฑุฌุงุน ุงููุถุงุนู:
def search_chunks(...) -> Tuple[List[Dict], List[Dict]]:
    # ุฅุฑุฌุงุน (chunks, extracted_terms)
```

---

## ๐ ูููู ุงููุดุฑูุน ุงูุฌุฏูุฏ

```
project/
โโโ app.py                          # Flask API (ูุญุฏูุซ)
โโโ frontend.py                     # Streamlit UI (ูุญุฏูุซ ุชูุงูุงู)
โโโ config.py                       # ุฅุนุฏุงุฏุงุช ุงููุดุฑูุน (ูุญุฏูุซ)
โโโ services/
โ   โโโ file_search.py             # ุฎุฏูุฉ ุงูุจุญุซ (ูุญุฏูุซุฉ)
โโโ context/
โ   โโโ Shariaah-Standards-ARB_structured.md
โโโ results/                        # โจ ูุฌูุฏ ุงููุชุงุฆุฌ ุงูุฌุฏูุฏ
โ   โโโ analysis_20251124_130000.json
โ   โโโ ...
โโโ FILE_SEARCH_GUIDE.md           # ุฏููู ุงูุจุญุซ
โโโ IMPROVEMENTS_LOG.md            # ูุฐุง ุงูููู
โโโ start.sh                       # ุณูุฑูุจุช ุงูุจุฏุก
```

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุจุฏุก ุงููุธุงู:
```bash
bash start.sh
```

### 2. ุงููุตูู ูููุงุฌูุงุช:
- **Streamlit UI**: http://0.0.0.0:5000
- **Flask API**: http://127.0.0.1:5001

### 3. ุฅุฏุฎุงู ุงูุนูุฏ:
```
1. ุฃุฏุฎู ูุต ุงูุนูุฏ ูู ุงูุญูู ุงููุตู
2. ุงุฎุชุฑ ุนุฏุฏ ุงููุชุงุฆุฌ (10-50)
3. ุงุถุบุท "ุจุฏุก ุงูุชุญููู"
4. ุงูุชุธุฑ 2-4 ุฏูุงุฆู
5. ุนุงูู ุงููุชุงุฆุฌ ูุญููููุง
```

### 4. ุงููุตูู ูููุชุงุฆุฌ ุงููุญููุธุฉ:
- ูู ุงููุชุงุฆุฌ ูุญููุธุฉ ุชููุงุฆูุงู ูู `results/`
- ูููู ุนุฑุถ ุขุฎุฑ 10 ูุชุงุฆุฌ ูู ุงูู Sidebar
- ูู ูุชูุฌุฉ ุชุญุชูู ุนูู ุงูุจูุงูุงุช ุงููุงููุฉ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ุนุฏุฏ Chunks:
- ุงูุจุญุซ ุงูุฌูุงุนู: 10 chunks
- ุงูุจุญุซ ุงููุนููู ููู ุจูุฏ: 2 chunks
- **ุงูุฅุฌูุงูู**: 12-20 chunks (ุจุฏู 30-35)

### ุนุฏุฏ ุงูุจููุฏ ุงููุณุชุฎุฑุฌุฉ:
- ุนุงุฏู: 5-10 ุจููุฏ
- ุญุณุงุณ: 3-6 ุจููุฏ
- **ุงูุฅุฌูุงูู**: 5-15 ุจูุฏ

### ุงูุฏูุฉ ุงูุดุฑุนูุฉ:
- โ ูุนุงููุฑ ุฏูููุฉ: 90%+
- โ ุฃูุซูุฉ ูุทุงุจูุฉ: 85%+
- โ ูุง ุงุฎุชูุงู: 95%+

---

## โ ุงูููุงุฆุฏ ุงูููุงุฆูุฉ

1. **๐ ุฃุณุฑุน:**
   - 50% ุชูููู ูู ุงูููุช (ูู 4 ุฏูุงุฆู โ 2 ุฏูููุฉ)
   
2. **๐พ ุฃุฎู:**
   - 45% ุชูููู ูู ุญุฌู ุงูุณูุงู (ูู 35k โ 20k ุญุฑู)
   
3. **๐ฏ ุฃุฏู:**
   - 90%+ ุฏูุฉ ูู ุฃุฑูุงู ุงููุนุงููุฑ
   - 95%+ ุชูููู ุงูุงุฎุชูุงู
   
4. **๐ ุฃูุถู ูุงุฌูุฉ:**
   - ุนุฑุถ ููุธู ูุณูู ุงูุงุณุชุฎุฏุงู
   - ุดุฑูุท ุจุญุซ ุฏุงุฎู ุงููุชุงุฆุฌ
   - ุญูุธ ุชููุงุฆู ูู ูุฌูุฏ ูููุตู
   
5. **๐ ููุซูู:**
   - retry logic ููุฃุฎุทุงุก ุงููุคูุชุฉ
   - error handling ูุญุณูู
   - fallback prompts

---

## ๐ ุงูููุงุฑูุฉ ุงูุดุงููุฉ

| ุงูููุฒุฉ | v1.0 (ูุจู) | v2.0 (ุจุนุฏ) |
|--------|-----------|----------|
| **ุงูุณุฑุนุฉ** | 4 ุฏูุงุฆู | 2.5 ุฏูููุฉ โ |
| **ุนุฏุฏ Chunks** | 30-35 | 12-20 โ |
| **ุญุฌู ุงูุณูุงู** | 35k ุญุฑู | 20k ุญุฑู โ |
| **ุฏูุฉ ุงููุนุงููุฑ** | 60-70% | 90%+ โ |
| **ูุงุฌูุฉ UI** | ุฃุณุงุณูุฉ | ูุชูุฏูุฉ โ |
| **ุญูุธ ุงููุชุงุฆุฌ** | ูุฏูู | ุชููุงุฆู โ |
| **ุงูุจุญุซ ูู ุงููุชุงุฆุฌ** | ูุง | ูุนู โ |
| **Retry Logic** | ูุง | ูุนู โ |

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุญูุธ ุงููุชุงุฆุฌ ุชููุงุฆูุงู:**
   - ูู ุชุญููู ููุญูุธ ุชููุงุฆูุงู ูู `results/`
   - ูููู ุญุฐู ุงููููุงุช ุงููุฏููุฉ ูุฏููุงู ุฅุฐุง ูุฒู ุงูุฃูุฑ

2. **ุงูุฃุฏุงุก:**
   - ุฃูู ุทูุจ ูุฏ ูููู ุฃุจุทุฃ (cold start)
   - ุงูุทูุจุงุช ุงููุงุญูุฉ ุชููู ุฃุณุฑุน (cache)

3. **ุงูุฏูุฉ:**
   - ูุนุงููุฑ AAOIFI ูู ุงูุจุญุซ ุงููุนููู ุฏูููุฉ ุฌุฏุงู
   - ูุฏ ุชุฎุชูู ููููุงู ุญุณุจ ูุต ุงูุนูุฏ

4. **ุงูุญุฏูุฏ:**
   - ุงูุญุฏ ุงูุฃุฏูู ูููุชุงุฆุฌ: 5
   - ุงูุญุฏ ุงูุฃูุตู ูููุชุงุฆุฌ: 50

---

## ๐ ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

1. **ุงูุจุญุซ ุงููุฌูู ูุนุงู:** ุฏูุฌ ุงูุจุญุซ ุงูุฌูุงุนู + ุงููุนููู ูุนุทู ุฃูุถู ุงููุชุงุฆุฌ
2. **ุชูููู ุงูุจูุงูุงุช ุถุฑูุฑู:** ูููู ูู 5 โ 2 chunks ูุงูู ููุฏูุฉ
3. **ุงููุงุฌูุฉ ูููุฉ:** ูุงุฌูุฉ ุฌูุฏุฉ ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุจูุณุจุฉ 300%
4. **ุงูุญูุธ ุงูุชููุงุฆู ุถุฑูุฑู:** ูุณูู ุชุชุจุน ุงููุชุงุฆุฌ ุงูุณุงุจูุฉ

---

## ๐ ุงูุฏุนู ูุงููุณุงุนุฏุฉ

ููุฃุณุฆูุฉ ุฃู ุงููุดุงูู:
1. ุชุญูู ูู `FILE_SEARCH_GUIDE.md` ูููุฒูุฏ ูู ุงูุชูุงุตูู
2. ุชุญูู ูู `results/` ูุขุฎุฑ ุงูุชุญูููุงุช
3. ุฑุงุฌุน ุงูู logs ูู `start.sh` output

---

**ุขุฎุฑ ุชุญุฏูุซ:** 24 ููููุจุฑ 2025
**ุงูุฅุตุฏุงุฑ:** v2.0 - Optimized Hybrid Search
**ุงูุญุงูุฉ:** โ ุฌููุน ุงูููุฒุงุช ุชุนูู ุจูุฌุงุญ
