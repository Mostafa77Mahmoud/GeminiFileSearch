# ๐ Gemini File Search - Islamic Finance Contract Analysis System

## ๐ ุขุฎุฑ ุชุญุฏูุซ: 24 ููููุจุฑ 2025

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุดุฑูุน

### ุงููุฏู:
ุจูุงุก ูุธุงู ูุชูุฏู ูุชุญููู ุงูุนููุฏ ุงูุฅุณูุงููุฉ (ุฎุงุตุฉ ุนููุฏ ุงูุงุณุชุตูุงุน) ููู ูุนุงููุฑ AAOIFI ุงูุดุฑุนูุฉ ุจุงุณุชุฎุฏุงู:
- **Google Gemini 2.5 Flash**: ูุงุณุชุฎุฑุงุฌ ุงูุจููุฏ ูุงูุชุญููู
- **Gemini File Search API**: ููุจุญุซ ุงูุฏูุงูู ุงูุนููู ูู ูุนุงููุฑ AAOIFI
- **Python + Flask**: ููู Backend API
- **Streamlit**: ููู Frontend UI

### ุงูุญุงูุฉ:
โ **ุงููุธุงู ูุงูู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู**

---

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ

### ุงููุฑุงุญู ุงูุซูุงุซ ูููุธุงู:

```
1๏ธโฃ ุงุณุชุฎุฑุงุฌ ุงูุจููุฏ
   โโ Gemini ูุญูู ุงูุนูุฏ ูุงููุงู
   โโ ูุณุชุฎุฑุฌ 5-15 ุจูุฏ ููู ููุท
   โโ ุฅุถุงูุฉ keywords ุดุฑุนูุฉ ุนุฑุจูุฉ
   โโ ุชูุณูู JSON

2๏ธโฃ ุงูุจุญุซ ุงููุฌูู (Hybrid)
   โโ ุงููุฑุญูุฉ ุฃ: ุจุญุซ ุฌูุงุนู (10 chunks)
   โโ ุงููุฑุญูุฉ ุจ: ุชุญุฏูุฏ ุงูุจููุฏ ุงูุญุณุงุณุฉ
   โโ ุงููุฑุญูุฉ ุฌ: ุจุญุซ ูุนููู (2 chunks ููู ุจูุฏ ุญุณุงุณ)

3๏ธโฃ ุฏูุฌ ุงููุชุงุฆุฌ
   โโ ุฅุฒุงูุฉ ุงูุชูุฑุงุฑ ุชููุงุฆูุงู
   โโ ุฅุนุงุฏุฉ ุชุฑููู ุงูู chunks
   โโ ุญูุธ ูู ูุฌูุฏ results/
```

### ูุนุงููุฑ ุงูุฃุฏุงุก ุงูุญุงููุฉ:
- โฑ๏ธ **ุงูููุช**: 2-3 ุฏูุงุฆู (ููุงุจู 4 ุฏูุงุฆู ุณุงุจูุงู)
- ๐ **ุนุฏุฏ Chunks**: 12-20 chunks (ููุงุจู 30-35 ุณุงุจูุงู)
- ๐ฏ **ุงูุฏูุฉ**: 90%+ ูุฃุฑูุงู ุงููุนุงููุฑ
- ๐ **ุญูุธ ุงููุชุงุฆุฌ**: ุชููุงุฆู ูู ูุฌูุฏ `results/`

---

## ๐๏ธ ุงูููููุงุช ุงูุฑุฆูุณูุฉ

### 1. **Backend (Flask API)**
- **ุงูููู**: `app.py`
- **ุงูููุงูุฐ**:
  - `GET  /health` - ูุญุต ุตุญุฉ ุงููุธุงู
  - `GET  /store-info` - ูุนูููุงุช File Search Store
  - `POST /extract_terms` - ุงุณุชุฎุฑุงุฌ ุงูุจููุฏ ููุท
  - `POST /file_search` - ุงูุนูููุฉ ุงููุงููุฉ

### 2. **ุฎุฏูุฉ ุงูุจุญุซ (File Search Service)**
- **ุงูููู**: `services/file_search.py`
- **ุงูุฏูุงู ุงูุฑุฆูุณูุฉ**:
  - `extract_key_terms()` - ุงุณุชุฎุฑุงุฌ ุงูุจููุฏ (ูุฑุญูุฉ 1)
  - `search_chunks()` - ุงูุจุญุซ ุงููุฌูู (ูุฑุญูุฉ 2-3)
  - `_get_sensitive_keywords()` - ุชุญุฏูุฏ ุงููููุงุช ุงูุญุณุงุณุฉ
  - `_filter_sensitive_clauses()` - ูุตู ุงูุจููุฏ ุงูุญุณุงุณุฉ
  - `_extract_grounding_chunks()` - ุงุณุชุฎุฑุงุฌ ุงููุชุงุฆุฌ

### 3. **Frontend (Streamlit UI)**
- **ุงูููู**: `frontend.py` (ูุญุฏูุซ ุชูุงูุงู)
- **ุงูููุฒุงุช**:
  - ูุงุฌูุฉ ุนุฑุจูุฉ ุงุญุชุฑุงููุฉ
  - ุนุฑุถ ููุธู ููุจููุฏ ูุงูู chunks
  - ุดุฑูุท ุจุญุซ ูู ุงููุชุงุฆุฌ
  - ุชูุฒูู JSON ู Text
  - ุนุฑุถ ุงูุณุฌู (ุขุฎุฑ 10 ุชุญูููุงุช)
  - ูุนูููุงุช ุงููุธุงู ูู Sidebar

### 4. **ุงูุฅุนุฏุงุฏุงุช (Configuration)**
- **ุงูููู**: `config.py`
- **ุงููุชุบูุฑุงุช ุงูุฑุฆูุณูุฉ**:
  - `GEMINI_API_KEY`: ููุชุงุญ API ูู Google
  - `MODEL_NAME`: gemini-2.5-flash (ูููุฐุฌ Gemini)
  - `TOP_K_CHUNKS`: 10 (ุนุฏุฏ chunks ุงูุจุญุซ ุงูุฌูุงุนู)
  - `EXTRACT_KEY_TERMS_PROMPT`: prompt ุงุณุชุฎุฑุงุฌ ุงูุจููุฏ
  - `FILE_SEARCH_PROMPT`: prompt ุงูุจุญุซ ุงููุญุณูู

---

## ๐ ูููู ุงููุดุฑูุน

```
project/
โโโ app.py                          # Flask API
โโโ frontend.py                     # Streamlit UI (ูุญุฏูุซ)
โโโ config.py                       # ุงูุฅุนุฏุงุฏุงุช (ูุญุฏูุซ)
โโโ services/
โ   โโโ file_search.py             # ุฎุฏูุฉ ุงูุจุญุซ (ูุญุฏูุซุฉ)
โโโ context/
โ   โโโ Shariaah-Standards-ARB_structured.md  # ูุชุงุจ AAOIFI
โโโ results/                        # ูุฌูุฏ ุงููุชุงุฆุฌ ุงูุฌุฏูุฏ โจ
โ   โโโ analysis_20251124_130000.json
โ   โโโ ...
โโโ start.sh                        # ุณูุฑูุจุช ุงูุจุฏุก
โโโ FILE_SEARCH_GUIDE.md           # ุฏููู ุงูุจุญุซ ุงูุดุงูู
โโโ IMPROVEMENTS_LOG.md            # ุณุฌู ุงูุชุญุณููุงุช ุงูุฌุฏูุฏ โจ
โโโ replit.md                      # ูุฐุง ุงูููู
โโโ .env                           # ูุชุบูุฑุงุช ุงูุจูุฆุฉ (ูู ุชูุฑูุน)
```

---

## ๐ ุงูููุฒุงุช ุงูุญุงููุฉ

### โ ุงูุจุญุซ ุงููุชูุฏู:
- ุจุญุซ ุฏูุงูู ุนููู (semantic search)
- keywords ุนุฑุจูุฉ ุฏูููุฉ
- retry logic ููุฃุฎุทุงุก ุงููุคูุชุฉ
- fallback prompts

### โ ุงููุงุฌูุฉ ุงููุญุณููุฉ:
- ุนุฑุถ ููุธู ููุจููุฏ
- ุดุฑูุท ุจุญุซ ูู ุงููุชุงุฆุฌ
- ุชูุฒูู JSON ู Text
- ุนุฑุถ ุงูุณุฌู ุงูุชุงุฑูุฎู

### โ ุฅุฏุงุฑุฉ ุงููุชุงุฆุฌ:
- ุญูุธ ุชููุงุฆู ูู `results/`
- ุงุณู ููู ูุญุชูู ุนูู ุงูุชุงุฑูุฎ
- ุฅููุงููุฉ ุงููุตูู ุงูุณุฑูุน ูููุชุงุฆุฌ ุงููุฏููุฉ

### โ ุงูุฃุฏุงุก ุงููุญุณูู:
- 50% ุฃุณุฑุน (ูู 4 ุฏูุงุฆู โ 2.5 ุฏูููุฉ)
- 45% ุฃูู ุจูุงูุงุช (ูู 35k โ 20k ุญุฑู)
- 90%+ ุฏูุฉ ูู ุงููุนุงููุฑ

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ุงูุจุญุซ ุงูุฌูุงุนู:
- ุนุฏุฏ ุงูู chunks: 10
- ุงูููุช: ~45 ุซุงููุฉ
- ุงูุบุฑุถ: ุชุบุทูุฉ ุดุงููุฉ

### ุงูุจุญุซ ุงููุนููู:
- ุนุฏุฏ ุงูุจููุฏ ุงูุญุณุงุณุฉ: 3-6
- chunks ููู ุจูุฏ: 2 (ุชู ุชููููู ูู 5)
- ุงูููุช: ~60 ุซุงููุฉ (5 ร 12 ุซุงููุฉ)
- ุงูุบุฑุถ: ุฏูุฉ ุนุงููุฉ ูููุดุงูู ุงูุญุณุงุณุฉ

### ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:
- ุฅุฌูุงูู ุงูู chunks: 12-20 chunk
- ุงูููุช ุงูููู: 2-3 ุฏูุงุฆู
- ุงูุฏูุฉ: 90%+ ูุฃุฑูุงู ุงููุนุงููุฑ

---

## ๐ ุฎูุงุฑุงุช ุงูุงุณุชุฎุฏุงู

### 1. ุงุณุชุฎุฑุงุฌ ุงูุจููุฏ ููุท:
```bash
curl -X POST http://127.0.0.1:5001/extract_terms \
  -H "Content-Type: application/json" \
  -d '{"contract_text": "ูุต ุงูุนูุฏ..."}'
```

### 2. ุงูุจุญุซ ุงููุงูู (Two-Step Hybrid):
```bash
curl -X POST http://127.0.0.1:5001/file_search \
  -H "Content-Type: application/json" \
  -d '{"contract_text": "ูุต ุงูุนูุฏ...", "top_k": 10}'
```

### 3. ูุงุฌูุฉ Streamlit:
- ุงูุชุญ `http://0.0.0.0:5000` ูู ุงููุชุตูุญ
- ุฃุฏุฎู ูุต ุงูุนูุฏ
- ุงุถุบุท "ุจุฏุก ุงูุชุญููู"
- ุนุงูู ุงููุชุงุฆุฌ ูุญููููุง

---

## ๐ ุงูุชุญุณููุงุช ุงูุฃุฎูุฑุฉ (v2.0)

### ุชุงุฑูุฎ: 24 ููููุจุฑ 2025

#### โจ ุงูุชุญุณููุงุช ุงููุทุจููุฉ:

1. **ุชูููู ุงูููุช**:
   - ุชูููู top_k ูู 5 โ 2 ูู ุงูุจุญุซ ุงููุนููู
   - ุงููุชูุฌุฉ: 50% ุฃุณุฑุน

2. **ุชูููู ุญุฌู ุงูุจูุงูุงุช**:
   - ูู 35 chunks โ 20 chunks
   - ูู 35k ุญุฑู โ 20k ุญุฑู

3. **ุชุญุณูู ุงููุงุฌูุฉ**:
   - ูุงุฌูุฉ Streamlit ุฌุฏูุฏุฉ ุชูุงูุงู
   - ุนุฑุถ ููุธู ููุจููุฏ ูุงูู chunks
   - ุดุฑูุท ุจุญุซ ูู ุงููุชุงุฆุฌ
   - ุชูุฒูู JSON ู Text

4. **ูุฌูุฏ ุงููุชุงุฆุฌ**:
   - `results/` ูุฌูุฏ ุฌุฏูุฏ
   - ุญูุธ ุชููุงุฆู ููู ุชุญููู
   - ูุนูููุงุช ุงูุชุงุฑูุฎ ูุงูููุช

5. **Retry Logic**:
   - ูุนุงูุฌุฉ 503 errors ุชููุงุฆูุงู
   - exponential backoff (2s, 4s, 8s)

---

## ๐ป ุงูุชุดุบูู

### ุงูุดุฑูุท ุงูุฃุณุงุณูุฉ:
```bash
- Python 3.11+
- Google Gemini API Key
- AAOIFI reference book (Markdown format)
```

### ุงูุจุฏุก:
```bash
bash start.sh
```

### ุงููุตูู:
- **API**: http://127.0.0.1:5001
- **UI**: http://0.0.0.0:5000

---

## ๐ ุงูุชูุซูู

- **FILE_SEARCH_GUIDE.md**: ุฏููู ุดุงูู ุนู ุขููุฉ ุงูุจุญุซ
- **IMPROVEMENTS_LOG.md**: ุณุฌู ูุงูู ุจุงูุชุญุณููุงุช
- **config.py**: ุชูุซูู ุงูุฅุนุฏุงุฏุงุช

---

## ๐ ูุชุทูุจุงุช ุงูุจูุฆุฉ

### ูุชุบูุฑุงุช ูุทููุจุฉ ูู `.env`:
```
GEMINI_API_KEY=your-api-key-here
MODEL_NAME=gemini-2.5-flash
FILE_SEARCH_STORE_ID=fileSearchStores/aaoifi-reference-store-vwvmgtb64hqq
```

---

## โ ุงูุญุงูุฉ ุงูููุงุฆูุฉ

| ุงููุนูุงุฑ | ุงูุญุงูุฉ |
|--------|--------|
| **ุงูุงุณุชุฎุฑุงุฌ** | โ ูุนูู ุจูุฌุงุญ |
| **ุงูุจุญุซ ุงูุฌูุงุนู** | โ ูุนูู ุจูุฌุงุญ |
| **ุงูุจุญุซ ุงููุนููู** | โ ูุนูู ุจูุฌุงุญ |
| **ุฏูุฌ ุงููุชุงุฆุฌ** | โ ูุนูู ุจูุฌุงุญ |
| **ุงููุงุฌูุฉ** | โ ูุญุฏูุซุฉ ุชูุงูุงู |
| **ุงูุญูุธ ุงูุชููุงุฆู** | โ ูุนูู |
| **Retry Logic** | โ ูุนูู |

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

1. โ ุงุฎุชุจุงุฑ ุงููุธุงู ูุน ุนูุฏ ุญูููู
2. โ ุชูููู ุฏูุฉ ุงููุนุงููุฑ ุงููุณุชุฎุฑุฌุฉ
3. โ ุชุฌููุน ููุงุญุธุงุช ุงููุณุชุฎุฏููู
4. ๐ ุฅุถุงูุฉ ูุนุงููุฑ ุฅุถุงููุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ
5. ๐ ุชูุณูุน ุงูุฏุนู ูุฃููุงุน ุนููุฏ ุฃุฎุฑู

---

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐**
